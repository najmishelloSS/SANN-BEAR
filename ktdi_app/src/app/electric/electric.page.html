<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button [defaultHref]="'/home'"></ion-back-button>
    </ion-buttons>
    <ion-title>Register Electrical Appliances</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Content for page 1 (No Appliance Registered)--> 
  <div *ngIf="page === 'page1'">
    <p><strong>No Appliance Registered</strong></p>
    <p class="additional-text">You have not registered for any appliance yet</p>
    <div style="text-align: center; margin-top: 50px;">
      <ion-button expand="full" shape="round" color="primary" class="ion-margin" (click)="navigateToPage('page2')" style="height: 7%;"> 
        Register
      </ion-button>
    </div>
  </div>

  <!-- Content for page 2 -->
  <div *ngIf="page === 'page2'" class="categories-container">
    <ion-grid>
      <ion-row *ngFor="let category of sortedCategories">
        <ion-col>
          <div class="category-box">
            <h2 class="label-text">{{ category }}</h2>
            <p class="additional-text">Select appliance from the list</p>
            <div class="item-container">
              <div class="item" *ngFor="let appliance of getAppliancesByCategory(category)" (click)="toggleSelection(appliance)" [class.selected-item]="appliance.selected">
                <ion-label>
                  <img [src]="appliance.image" alt="Appliance Image" style="width: 50px; height: 40px;">
                  <p><strong>{{ appliance.name }}</strong></p>
                  <p><strong>Price:</strong> RM{{ appliance.price }}</p>
                </ion-label>
              </div>
            </div>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>

    <ion-footer class="ion-no-border">
      <ion-row class="ion-align-items-center">
        <ion-col>
          <ion-label class="total-price">
            <b>RM {{ totalPrice | number: '1.2-2' }}</b>
            <p><span class="tax-text">inc. of all taxes</span></p>
          </ion-label>
        </ion-col>
        <ion-col class="ion-text-center">
          <ion-button (click)="navigateToPage('page3')" expand="block" color="primary" shape="round">
            Proceed
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-footer>
  </div>

<!-- Content for page 3 -->
<ion-content>
  <div *ngIf="page === 'page3'">
    <h2>Select Payment Type</h2>
    <!-- Ion-segment buttons for payment methods -->
    <ion-segment>
      <ion-segment-button (click)="selectPaymentMethod('Credit Card')">Credit Card</ion-segment-button>
      <ion-segment-button (click)="selectPaymentMethod('Debit Card')">Debit Card</ion-segment-button>
      <ion-segment-button (click)="selectPaymentMethod('PayPal')">PayPal</ion-segment-button>
      <ion-segment-button (click)="showQRCode()">QR Code</ion-segment-button>
    </ion-segment>

    <!-- Payment section for Credit Card or Debit Card -->
    <div *ngIf="showPaymentSection && (selectedPaymentMethod === 'Credit Card' || selectedPaymentMethod === 'Debit Card')">
      <!-- Button to initiate payment -->
      <ion-button (click)="initiateStripePayment()">Pay Now</ion-button>
    </div>

    <!-- QR Code section -->
<div *ngIf="showQRCodeSection" style="text-align: center;">
  <ng-container *ngTemplateOutlet="qrCodeContent"></ng-container>
  <ion-button (click)="navigateToPaymentSuccessful()">Pay</ion-button>
</div>

<ng-template #qrCodeContent>
  <!-- Display the QR code image -->
  <img src="assets\image\qr.jpg" alt="QR Code" style="display: block; margin: 0 auto;">
</ng-template>

    <!-- Payment successful message -->
    <div *ngIf="paymentSuccessful">
      <h2>Payment Successful!</h2>
      <!-- Additional details or customization for successful payment -->
      <!-- Button to submit registration after successful payment -->
      <ion-button (click)="submitRegistration(paymentId)">Submit </ion-button>
    </div>

    <!-- Approval message -->
    <div *ngIf="submitted" style="text-align: center; margin-top: 50px;">
      <p><strong>Your registration has been approved</strong></p>
    </div>
  </div>

  <!-- Content for registeredPage (Registration Completed) -->
  <div *ngIf="page === 'registeredPage'">
    <h2>You have already registered</h2>
    <!-- Navigate back to the default home page -->
    <ion-buttons slot="start">
      <ion-back-button [defaultHref]="'/home'"></ion-back-button>
    </ion-buttons>
    <ion-label style="text-align: center;">Go back</ion-label>
  </div>
</ion-content>